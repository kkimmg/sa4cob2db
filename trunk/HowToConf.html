<html>
<head>
<title>設定について</title>
</head>
<body>
<ol>
<li>
環境変数について
<table border="1">
<tr><th>環境変数</th><th>説明</th><th>サンプル</th></tr>
<tr><td>ACM_METAFILE</td><td>メタデータの設定ファイルのファイル名</td><td>sa4cob2db/conf/metafile.xml</td></tr>
<tr><td>ACM_CONFFILE</td><td>メタデータの設定ファイルのファイル名</td><td>sa4cob2db/conf/metafile.xml</td></tr>
<tr><td>ACMLIBS_DIR</td><td>acmlibs.jarの存在するディレクトリ</td><td>sa4cob2db</td></tr>
<tr><td>ACM_HOSTNAME</td><td>SQLNetServerが動作しているホスト</td><td>localhost</td></tr>
<tr><td>ACM_USERNAME</td><td>SQLNetServerに接続するためのユーザー名</td><td>username</td></tr>
<tr><td>ACM_PASSWORD</td><td>SQLNetServerに接続するためのパスワード</td><td>password</td></tr>
<tr><td>acm_pp_charset</td><td>コード変換時のキャラクターセット</td><td>EUCJP</td></tr>
<tr><td>ACM_SESSIONLISTENERS</td><td>セッションのイベント処理を行うクラス<br>複数設定する場合はコロン(:)区切り</td><td>ACMSessionEventAdapterTest</td></tr>
<tr><td>ACM_SERVERLISTENERS</td><td>SQLNetServerのイベント処理を行うクラス<br>複数設定する場合はコロン(:)区切り</td><td>ACMServerEventAdapterTest:k_kim_mg.sa4cob2db.admin.MinAdminAdapter</td></tr>
<tr><td>ACMOFF_FILE</td><td>SQLNetServerをリモート停止するための設定ファイル</td><td>sa4cob2db/conf/shutdown.conf</td></tr>
</table>
</li>
<li>
設定ファイルの書き方について<br/>
場合によっては<a href="conf/metafile.dtd">DTD</a>をみた方が早いかも。
<ol>
<li>meatadataset:全体部分</li>
<ol>
	<li>property</li>データベース関連意外の設定項目。<br/>
	name属性で設定項目のキーを示します。<br/>
	使用済のname属性の値
	<ol>
		<li>jdbcdriverurl</li>JDBCドライバのURL。<br/>
				設定ファイルではクラスパスを設定・更新しません。<br/>
				JDBCドライバへのクラスパスは起動スクリプトなどに記述しておいてください。
		<li>jdbcdatabaseurl</li>JDBCデータベースのURL。
		<li>jdbcusername</li>データベースユーザー名。
		<li>jdbcpassword</li>データベースパスワード。
		<li>address</li>受付アドレス。","(カンマ)で区切って複数指定できます。<br/>既定値はローカルアドレスのみです。
		<li>port</li>受付ポート。<br/>既定値は12345です。
		<li>maxsessions</li>セッション数の上限。ただし、0は無制限
		<li>log</li>ログ構成ファイル。
		<li>authfile</li>パスワードファイル。
		<li>adminfile</li>管理用パスワードファイル。
		<li>backlog</li>SQLNetServerが使用するサーバーソケットのバックログ。
		<li>sessionlisteners</li>セッションイベントを処理するクラスのクラス名(:(コロン)区切り)。
		<li>serverlisteners</li>サーバーイベントを処理するクラスのクラス名(:(コロン)区切り)。
	</ol>
	<li>otherofset</li>metadataset直下に存在するその他のノードを処理するためのクラス。ここで指定されるクラスは<a href="doc/jp/ne/biglobe/mvh/k_kim_mg/acm/sql/xml/MetaDataSetNodeProcessor.html">MetaDataSetNodeProcessor<a/>インターフェースを実装する必要があります。
	<li>otherofmeta</li>metadata直下に存在するその他のノードを処理するためのクラス。ここで指定されるクラスは<a href="doc/jp/ne/biglobe/mvh/k_kim_mg/acm/sql/xml/MetaDataNodeProcessor.html">MetaDataNodeProcessor<a/>インターフェースを実装する必要があります。
	<li>metadata:各コボルファイル相当部分</li>
	属性
	<ol>
		<li>name</li>コボルファイル名。<br/>SELECT XXXX ASSIGN TO YYYY.のYYYYに相当する名称を設定します。
		<li>bufinit</li>初期バッファサイズ。<br/>シーケンシャルリード時にバッファリングするレコードの初期件数。<br/>初期サイズに達するまでREAD NEXT処理は待機されます
		<li>bufmin</li>最小バッファサイズ。<br/>シーケンシャルリード時にバッファリングするレコードの最小件数。<br/>最小サイズに達するまでREAD NEXT処理は待機されます。
		<li>bufmax</li>最大バッファサイズ。<br/>シーケンシャルリード時にバッファリングするレコードの最大件数。
		<li>encode</li>レコードの文字エンコーディング
		<li>customClassName</li>組み込みでない独自の動作をさせるためのクラス。<br/>ここで指定されるクラスは<a href="doc/jp/ne/biglobe/mvh/k_kim_mg/acm/CobolRecordMetaData.html">CobolRecordMetaData<a/>インターフェースを実装する必要があります。
	</ol>
	ノード
	<ol>
		<li>statement</li>SELECT文<br/>乱読み出しを行う場合は必ずORDER BY句で結果セットがキー順になるようにソートしてください。
		<li>sqlcolumn</li>SELECT文で指定した結果セットの列をそのままコボルレコードの列に割り当てます。<br/>
		属性
		<ol>
			<li>name</li>列名。<br/>sqlcolumn/customcolumnに関わらずmetadata内で一意に識別可能な名前を仕様してください。<br/>(1ファイル内で重複しないようにしてください。)
			<li>type</li>データ型。対応するデータの方を整数値で指定します。
				
			<li>start</li>開始位置。0で始まります。
			<li>length</li>列長。バイト数です。
			<li>format</li>書式文字列。数値型などのデータの整形などに利用します。<br/>
					組み込みの型では以下に対応するフォーマット文字列を利用します。<br/>
					<table border="1">
					<tr><th>データ型</th><th>クラス</th>
					<tr><td>数値型</td><td>java.text.DecimalFormat</td>
					<tr><td>日付型</td><td>java.text.SimpleDateFormat</td>
					</table>
			<li>originalColumnName</li>SQL結果セットのフィールド名。
			<li>defaultString</li>
			<li>readIgnore</li>読み込み(read/select)時に無視するかどうか<br/>設定しない場合は"false"。</br>
				<table border="1">
					<tr><th>セットした値</th><th>動作</th>
					<tr><td><b>false</b></td><td>結果セットの値でコボル側データを更新する。</td>
					<tr><td>true</td><td>結果セットの値でコボル側データを更新しない。</td>
				</table>
			<li>rewriteIgnore</li>更新(rewrite/update)時に無視するかどうか<br/>設定しない場合は"false"。</br>
				<table border="1">
					<tr><th>セットした値</th><th>動作</th>
					<tr><td><b>false</b></td><td>コボル側データで結果セットの値を更新する。</td>
					<tr><td>true</td><td>コボル側データで結果セットの値を更新しない。</td>
				</table>
			<li>writeIgnore</li>挿入(write/insert)時に無視するかどうか<br/>設定しない場合は"false"。</br>
				<table border="1">
					<tr><th>セットした値</th><th>動作</th>
					<tr><td><b>false</b></td><td>コボル側データで結果セットの値を更新する。</td>
					<tr><td>true</td><td>コボル側データで結果セットの値を更新しない。</td>
				</table>
		</ol>
		<li>customcolumn</li>組み込みの列では実現できない独自の動作をする列を定義します。<br/>
		属性
		<ol>
			<li>name</li>列名。<br/>sqlcolumn/customcolumnに関わらずmetadata内で一意に識別可能な名前を仕様してください。<br/>(1ファイル内で重複しないようにしてください。)
			<li>classname</li>列の動作を規定するクラス名。ここに指定されるクラスは<a href="doc/jp/ne/biglobe/mvh/k_kim_mg/acm/CobolColumn.html">CobolColumn</a>を実装する必要があります。<br/>
				設定ファイルではクラスパスを設定・更新しません。<br/>
				クラスパスは起動スクリプトなどに記述しておいてください
			<li>constructor</li>この列のクラスのオブジェクトを作成するためのコンストラクタを選択します。
				<table border="1">
				<tr><th>値</th><th colspan="2">引数</th></tr>
				<tr><td>1</td><td colspan="2">引数なし</td><tr>
				<tr><td>2</td><td>メタデータ</td><td>この列を含むメタデータ/ファイルレイアウトに相当するmetadataオブジェクト</td><tr>
				<tr rowspan="2"><td rowspan="2">3</td><td>メタデータ</td><td>この列を含むメタデータ/ファイルレイアウトに相当するmetadataオブジェクト</td></tr>
				<tr><td>ノード</td><td>この列を定義しているnodeオブジェクト</td></tr>
				</table>
			<li>type</li>sqlcolumnに同じ。なくてもよい。				
			<li>start</li>sqlcolumnに同じ。なくてもよい。
			<li>length</li>sqlcolumnに同じ。なくてもよい。
			<li>format</li>sqlcolumnに同じ。なくてもよい。
			<li>originalColumnName</li>sqlcolumnに同じ。なくてもよい。
			<li>defaultString</li>sqlcolumnに同じ。なくてもよい。
			<li>readIgnore</li>sqlcolumnに同じ。なくてもよい。
			<li>rewriteIgnore</li>sqlcolumnに同じ。なくてもよい。
			<li>writeIgnore</li>sqlcolumnに同じ。なくてもよい。
		</ol>
		<li>keycolumn</li>キー項目の列名(sqlcolumn/customcolumnのname属性の値)
		<li>indexfile</li>START命令などで使用するための索引を定義します。<br>
		属性
		<ol> 
			<li>filename</li>事前に作成したレイアウト/メタデータ/ファイルを指定します。
			<li>indexname</li>COBOLプログラムが使用するための索引名を指定します。
		</ol>
		ノード<br/>
		ファイルとインデックスの列の関連付けを行います。
		<ol>
			<li>index2file</li>インデックスの列をファイルのキー列に割り当てます。<br/>
			属性
			<ol>
				<li>filecolumn</li>ファイル側の列
				<li>indexcolumn</li>インデックス側の列
			</ol>
			<li>file2index</li>ファイルの列をインデックスのキー列に割り当てます。<br/>
			属性
			<ol>
				<li>filecolumn</li>ファイル側の列
				<li>indexcolumn</li>インデックス側の列
			</ol>
		</ol>
		<li>truncate</li>全データを削除するSQL文を記述します。<br/>
				ファイルをOUTPUTモードでオープンしたときに実行されます。

		<li>listener</li>このメタデータのイベント処理を行うクラスを指定します。<br/>ここで指定するクラスはCobolFileEventListenerを実装しなければなりません。
	</ol>
</ol>
</li>
</ol>
</body>
</html>

